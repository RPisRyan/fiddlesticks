function runTest() {
    var box = new paper.Path({
        segments: [
            new paper.Point(0, 0),
            new paper.Point(10, 0),
            new paper.Point(10, 10),
            new paper.Point(0, 10)
        ],
        closed: true
    });
    var section = new FontShape.PathSection(box, 0.1, 0.1);
    assertEqual(4, section.length);
    assertPointEqual(new paper.Point(4, 0), section.getPointAt(0));
    assertPointEqual(new paper.Point(8, 0), section.getPointAt(4));
    var sectionOverStart = new FontShape.PathSection(box, 0.9, 0.2);
    assertEqual(8, sectionOverStart.length);
    assertPointEqual(new paper.Point(0, 4), sectionOverStart.getPointAt(0));
    assertPointEqual(new paper.Point(4, 0), sectionOverStart.getPointAt(8));
}
function assertPointEqual(expected, actual) {
    if (expected.subtract(actual).length > 0.0001) {
        console.error("expected " + expected + ", was " + actual);
    }
}
function assertEqual(expected, actual) {
    if (Math.abs(expected - actual) > 0.0001) {
        console.error("expected " + expected + ", was " + actual);
    }
}
var paper = require("paper");
var Canvas = require('canvas'), Image = Canvas.Image;
var startServer = function () {
    var express = require("express");
    var bodyParser = require("body-parser");
    var aws = require("aws-sdk");
    var http = require("http");
    var path = require("path");
    var app = express();
    var AWS_ACCESS_KEY = process.env.AWS_ACCESS_KEY;
    var AWS_SECRET_KEY = process.env.AWS_SECRET_KEY;
    var S3_BUCKET = process.env.S3_BUCKET;
    app.use(bodyParser.json());
    app.set("port", (process.env.PORT || 7702));
    var sitePath = path.join(__dirname, "../../site");
    app.use("/css", express.static(path.join(sitePath, "css")));
    app.use("/fonts", express.static(path.join(sitePath, "fonts")));
    app.use("/lib", express.static(path.join(sitePath, "lib")));
    app.use("/img", express.static(path.join(sitePath, "img")));
    app.use("/content", express.static(path.join(sitePath, "content")));
    var indexPath = path.join(sitePath, "index.html");
    app.get("/", function (req, res) {
        res.sendFile(indexPath);
    });
    app.get("/sketch/*", function (req, res) {
        res.sendFile(indexPath);
    });
    app.get("/demo", function (req, res) {
        res.sendFile(path.join(sitePath, "demo.html"));
    });
    app.get("/api/storage/access", function (req, res) {
        aws.config.update({ accessKeyId: AWS_ACCESS_KEY, secretAccessKey: AWS_SECRET_KEY });
        var s3 = new aws.S3();
        var s3params = {
            Bucket: S3_BUCKET,
            Key: req.query.fileName,
            Expires: 4000,
            ContentType: req.query.fileType,
            ACL: "public-read"
        };
        s3.getSignedUrl("putObject", s3params, function (err, data) {
            if (err) {
                console.log(err);
            }
            else {
                var returnData = {
                    signedRequest: data,
                    url: "https://" + S3_BUCKET + ".s3.amazonaws.com/" + req.query.fileName
                };
                res.type("application/json");
                res.write(JSON.stringify(returnData));
                res.end();
            }
        });
    });
    app.get("/api/storage/url", function (req, res) {
        var returnData = {
            url: "https://" + S3_BUCKET + ".s3.amazonaws.com/" + req.query.fileName
        };
        res.type("application/json");
        res.write(JSON.stringify(returnData));
        res.end();
    });
    app.post('/api/client-errors', function (req, res) {
        console.error("[client]", req.body);
        res.end();
    });
    app.listen(app.get("port"), function () {
        console.log("Node app is running on port", app.get("port"));
    });
};
// var canvas = new Canvas(1000, 1000);
// paper.setup(canvas);
// var region = paper.Path.Ellipse(new paper.Rectangle(
//                     new paper.Point(0,0),
//                     new paper.Size(600, 300)
//                 ));
// console.log(region.bounds.size.width);
// region.rotate(30);
// console.log(region.bounds.size.width);
startServer();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvZm9udFNoYXBlVGVzdC50cyIsIi4uL3NyYy9kZXBzLmpzIiwiLi4vc3JjL3NlcnZlci5qcyIsIi4uL3NyYy96X3N0YXJ0LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBO0lBRUksSUFBTSxHQUFHLEdBQUcsSUFBSSxLQUFLLENBQUMsSUFBSSxDQUFDO1FBQ3ZCLFFBQVEsRUFBRTtZQUNOLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQ3JCLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBQ3RCLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDO1lBQ3ZCLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDO1NBQ3pCO1FBQ0QsTUFBTSxFQUFFLElBQUk7S0FDZixDQUFDLENBQUM7SUFFSCxJQUFNLE9BQU8sR0FBRyxJQUFJLFNBQVMsQ0FBQyxXQUFXLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUN6RCxXQUFXLENBQUMsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUMvQixnQkFBZ0IsQ0FBQyxJQUFJLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUMvRCxnQkFBZ0IsQ0FBQyxJQUFJLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUUvRCxJQUFNLGdCQUFnQixHQUFHLElBQUksU0FBUyxDQUFDLFdBQVcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ2xFLFdBQVcsQ0FBQyxDQUFDLEVBQUUsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDeEMsZ0JBQWdCLENBQUMsSUFBSSxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxnQkFBZ0IsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN4RSxnQkFBZ0IsQ0FBQyxJQUFJLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLGdCQUFnQixDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBRTVFLENBQUM7QUFFRCwwQkFBMEIsUUFBcUIsRUFBRSxNQUFtQjtJQUNoRSxFQUFFLENBQUMsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBQzVDLE9BQU8sQ0FBQyxLQUFLLENBQUMsY0FBWSxRQUFRLGNBQVMsTUFBUSxDQUFDLENBQUM7SUFDekQsQ0FBQztBQUNMLENBQUM7QUFFRCxxQkFBcUIsUUFBZ0IsRUFBRSxNQUFjO0lBQ2pELEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsUUFBUSxHQUFHLE1BQU0sQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDdkMsT0FBTyxDQUFDLEtBQUssQ0FBQyxjQUFZLFFBQVEsY0FBUyxNQUFRLENBQUMsQ0FBQztJQUN6RCxDQUFDO0FBQ0wsQ0FBQztBQ25DRCxJQUFJLEtBQUssR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7QUFFN0IsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUMxQixLQUFLLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQztBQ0Z6QixJQUFJLFdBQVcsR0FBRztJQUVkLElBQUksT0FBTyxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUNqQyxJQUFJLFVBQVUsR0FBRyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUE7SUFDdkMsSUFBSSxHQUFHLEdBQUcsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQzdCLElBQUksSUFBSSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUMzQixJQUFJLElBQUksR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7SUFFM0IsSUFBSSxHQUFHLEdBQUcsT0FBTyxFQUFFLENBQUM7SUFFcEIsSUFBSSxjQUFjLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUM7SUFDaEQsSUFBSSxjQUFjLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUM7SUFDaEQsSUFBSSxTQUFTLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUM7SUFFdEMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztJQUUzQixHQUFHLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUM7SUFFNUMsSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsWUFBWSxDQUFDLENBQUM7SUFFbEQsR0FBRyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDNUQsR0FBRyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDaEUsR0FBRyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDNUQsR0FBRyxDQUFDLEdBQUcs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LEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztJQUNkLENBQUMsQ0FBQyxDQUFDO0lBRUgsR0FBRyxDQUFDLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxVQUFTLEdBQUcsRUFBRSxHQUFHO1FBQzVDLE9BQU8sQ0FBQyxLQUFLLENBQUMsVUFBVSxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNwQyxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUM7SUFDZCxDQUFDLENBQUMsQ0FBQztJQUVILEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRTtRQUN4QixPQUFPLENBQUMsR0FBRyxDQUFDLDZCQUE2QixFQUFFLEdBQUcsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUNoRSxDQUFDLENBQUMsQ0FBQztBQUVQLENBQUMsQ0FBQTtBQ2pGRCx1Q0FBdUM7QUFDdkMsdUJBQXVCO0FBQ3ZCLHVEQUF1RDtBQUN2RCw0Q0FBNEM7QUFDNUMsK0NBQStDO0FBQy9DLHNCQUFzQjtBQUN0Qix5Q0FBeUM7QUFDekMscUJBQXFCO0FBQ3JCLHlDQUF5QztBQUV6QyxXQUFXLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIlxyXG5mdW5jdGlvbiBydW5UZXN0KCkge1xyXG5cclxuICAgIGNvbnN0IGJveCA9IG5ldyBwYXBlci5QYXRoKHtcclxuICAgICAgICBzZWdtZW50czogW1xyXG4gICAgICAgICAgICBuZXcgcGFwZXIuUG9pbnQoMCwgMCksXHJcbiAgICAgICAgICAgIG5ldyBwYXBlci5Qb2ludCgxMCwgMCksXHJcbiAgICAgICAgICAgIG5ldyBwYXBlci5Qb2ludCgxMCwgMTApLFxyXG4gICAgICAgICAgICBuZXcgcGFwZXIuUG9pbnQoMCwgMTApXHJcbiAgICAgICAgXSxcclxuICAgICAgICBjbG9zZWQ6IHRydWVcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IHNlY3Rpb24gPSBuZXcgRm9udFNoYXBlLlBhdGhTZWN0aW9uKGJveCwgMC4xLCAwLjEpO1xyXG4gICAgYXNzZXJ0RXF1YWwoNCwgc2VjdGlvbi5sZW5ndGgpO1xyXG4gICAgYXNzZXJ0UG9pbnRFcXVhbChuZXcgcGFwZXIuUG9pbnQoNCwgMCksIHNlY3Rpb24uZ2V0UG9pbnRBdCgwKSk7XHJcbiAgICBhc3NlcnRQb2ludEVxdWFsKG5ldyBwYXBlci5Qb2ludCg4LCAwKSwgc2VjdGlvbi5nZXRQb2ludEF0KDQpKTtcclxuXHJcbiAgICBjb25zdCBzZWN0aW9uT3ZlclN0YXJ0ID0gbmV3IEZvbnRTaGFwZS5QYXRoU2VjdGlvbihib3gsIDAuOSwgMC4yKTtcclxuICAgIGFzc2VydEVxdWFsKDgsIHNlY3Rpb25PdmVyU3RhcnQubGVuZ3RoKTtcclxuICAgIGFzc2VydFBvaW50RXF1YWwobmV3IHBhcGVyLlBvaW50KDAsIDQpLCBzZWN0aW9uT3ZlclN0YXJ0LmdldFBvaW50QXQoMCkpO1xyXG4gICAgYXNzZXJ0UG9pbnRFcXVhbChuZXcgcGFwZXIuUG9pbnQoNCwgMCksIHNlY3Rpb25PdmVyU3RhcnQuZ2V0UG9pbnRBdCg4KSk7XHJcblxyXG59XHJcblxyXG5mdW5jdGlvbiBhc3NlcnRQb2ludEVxdWFsKGV4cGVjdGVkOiBwYXBlci5Qb2ludCwgYWN0dWFsOiBwYXBlci5Qb2ludCl7XHJcbiAgICBpZiAoZXhwZWN0ZWQuc3VidHJhY3QoYWN0dWFsKS5sZW5ndGggPiAwLjAwMDEpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGBleHBlY3RlZCAke2V4cGVjdGVkfSwgd2FzICR7YWN0dWFsfWApO1xyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBhc3NlcnRFcXVhbChleHBlY3RlZDogbnVtYmVyLCBhY3R1YWw6IG51bWJlcil7XHJcbiAgICBpZiAoTWF0aC5hYnMoZXhwZWN0ZWQgLSBhY3R1YWwpID4gMC4wMDAxKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihgZXhwZWN0ZWQgJHtleHBlY3RlZH0sIHdhcyAke2FjdHVhbH1gKTtcclxuICAgIH1cclxufVxyXG4iLCJ2YXIgcGFwZXIgPSByZXF1aXJlKFwicGFwZXJcIik7XHJcblxyXG52YXIgQ2FudmFzID0gcmVxdWlyZSgnY2FudmFzJylcclxuICAsIEltYWdlID0gQ2FudmFzLkltYWdlOyIsIlxyXG52YXIgc3RhcnRTZXJ2ZXIgPSBmdW5jdGlvbigpIHtcclxuXHJcbiAgICB2YXIgZXhwcmVzcyA9IHJlcXVpcmUoXCJleHByZXNzXCIpO1xyXG4gICAgdmFyIGJvZHlQYXJzZXIgPSByZXF1aXJlKFwiYm9keS1wYXJzZXJcIilcclxuICAgIHZhciBhd3MgPSByZXF1aXJlKFwiYXdzLXNka1wiKTtcclxuICAgIHZhciBodHRwID0gcmVxdWlyZShcImh0dHBcIik7XHJcbiAgICB2YXIgcGF0aCA9IHJlcXVpcmUoXCJwYXRoXCIpO1xyXG5cclxuICAgIHZhciBhcHAgPSBleHByZXNzKCk7XHJcblxyXG4gICAgdmFyIEFXU19BQ0NFU1NfS0VZID0gcHJvY2Vzcy5lbnYuQVdTX0FDQ0VTU19LRVk7XHJcbiAgICB2YXIgQVdTX1NFQ1JFVF9LRVkgPSBwcm9jZXNzLmVudi5BV1NfU0VDUkVUX0tFWTtcclxuICAgIHZhciBTM19CVUNLRVQgPSBwcm9jZXNzLmVudi5TM19CVUNLRVQ7XHJcblxyXG4gICAgYXBwLnVzZShib2R5UGFyc2VyLmpzb24oKSk7XHJcblxyXG4gICAgYXBwLnNldChcInBvcnRcIiwgKHByb2Nlc3MuZW52LlBPUlQgfHwgNzcwMikpO1xyXG5cclxuICAgIHZhciBzaXRlUGF0aCA9IHBhdGguam9pbihfX2Rpcm5hbWUsIFwiLi4vLi4vc2l0ZVwiKTtcclxuXHJcbiAgICBhcHAudXNlKFwiL2Nzc1wiLCBleHByZXNzLnN0YXRpYyhwYXRoLmpvaW4oc2l0ZVBhdGgsIFwiY3NzXCIpKSk7XHJcbiAgICBhcHAudXNlKFwiL2ZvbnRzXCIsIGV4cHJlc3Muc3RhdGljKHBhdGguam9pbihzaXRlUGF0aCwgXCJmb250c1wiKSkpO1xyXG4gICAgYXBwLnVzZShcIi9saWJcIiwgZXhwcmVzcy5zdGF0aWMocGF0aC5qb2luKHNpdGVQYXRoLCBcImxpYlwiKSkpO1xyXG4gICAgYXBwLnVzZShcIi9pbWdcIiwgZXhwcmVzcy5zdGF0aWMocGF0aC5qb2luKHNpdGVQYXRoLCBcImltZ1wiKSkpO1xyXG4gICAgYXBwLnVzZShcIi9jb250ZW50XCIsIGV4cHJlc3Muc3RhdGljKHBhdGguam9pbihzaXRlUGF0aCwgXCJjb250ZW50XCIpKSk7XHJcblxyXG4gICAgdmFyIGluZGV4UGF0aCA9IHBhdGguam9pbihzaXRlUGF0aCwgXCJpbmRleC5odG1sXCIpO1xyXG4gICAgYXBwLmdldChcIi9cIiwgZnVuY3Rpb24ocmVxLCByZXMpIHtcclxuICAgICAgICByZXMuc2VuZEZpbGUoaW5kZXhQYXRoKTtcclxuICAgIH0pO1xyXG4gICAgYXBwLmdldChcIi9za2V0Y2gvKlwiLCBmdW5jdGlvbihyZXEsIHJlcykge1xyXG4gICAgICAgIHJlcy5zZW5kRmlsZShpbmRleFBhdGgpO1xyXG4gICAgfSk7XHJcbiAgICBhcHAuZ2V0KFwiL2RlbW9cIiwgZnVuY3Rpb24ocmVxLCByZXMpIHtcclxuICAgICAgICByZXMuc2VuZEZpbGUocGF0aC5qb2luKHNpdGVQYXRoLCBcImRlbW8uaHRtbFwiKSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBhcHAuZ2V0KFwiL2FwaS9zdG9yYWdlL2FjY2Vzc1wiLCBmdW5jdGlvbihyZXEsIHJlcykge1xyXG4gICAgICAgIGF3cy5jb25maWcudXBkYXRlKHsgYWNjZXNzS2V5SWQ6IEFXU19BQ0NFU1NfS0VZLCBzZWNyZXRBY2Nlc3NLZXk6IEFXU19TRUNSRVRfS0VZIH0pO1xyXG4gICAgICAgIHZhciBzMyA9IG5ldyBhd3MuUzMoKTtcclxuICAgICAgICB2YXIgczNwYXJhbXMgPSB7XHJcbiAgICAgICAgICAgIEJ1Y2tldDogUzNfQlVDS0VULFxyXG4gICAgICAgICAgICBLZXk6IHJlcS5xdWVyeS5maWxlTmFtZSxcclxuICAgICAgICAgICAgRXhwaXJlczogNDAwMCwgLy8gb3ZlciAxIGhvdXJcclxuICAgICAgICAgICAgQ29udGVudFR5cGU6IHJlcS5xdWVyeS5maWxlVHlwZSxcclxuICAgICAgICAgICAgQUNMOiBcInB1YmxpYy1yZWFkXCJcclxuICAgICAgICB9O1xyXG4gICAgICAgIHMzLmdldFNpZ25lZFVybChcInB1dE9iamVjdFwiLCBzM3BhcmFtcywgZnVuY3Rpb24oZXJyLCBkYXRhKSB7XHJcbiAgICAgICAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmV0dXJuRGF0YSA9IHtcclxuICAgICAgICAgICAgICAgICAgICBzaWduZWRSZXF1ZXN0OiBkYXRhLFxyXG4gICAgICAgICAgICAgICAgICAgIHVybDogXCJodHRwczovL1wiICsgUzNfQlVDS0VUICsgXCIuczMuYW1hem9uYXdzLmNvbS9cIiArIHJlcS5xdWVyeS5maWxlTmFtZVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIHJlcy50eXBlKFwiYXBwbGljYXRpb24vanNvblwiKTtcclxuICAgICAgICAgICAgICAgIHJlcy53cml0ZShKU09OLnN0cmluZ2lmeShyZXR1cm5EYXRhKSk7XHJcbiAgICAgICAgICAgICAgICByZXMuZW5kKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGFwcC5nZXQoXCIvYXBpL3N0b3JhZ2UvdXJsXCIsIGZ1bmN0aW9uKHJlcSwgcmVzKSB7XHJcbiAgICAgICAgdmFyIHJldHVybkRhdGEgPSB7XHJcbiAgICAgICAgICAgIHVybDogXCJodHRwczovL1wiICsgUzNfQlVDS0VUICsgXCIuczMuYW1hem9uYXdzLmNvbS9cIiArIHJlcS5xdWVyeS5maWxlTmFtZVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmVzLnR5cGUoXCJhcHBsaWNhdGlvbi9qc29uXCIpO1xyXG4gICAgICAgIHJlcy53cml0ZShKU09OLnN0cmluZ2lmeShyZXR1cm5EYXRhKSk7XHJcbiAgICAgICAgcmVzLmVuZCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgYXBwLnBvc3QoJy9hcGkvY2xpZW50LWVycm9ycycsIGZ1bmN0aW9uKHJlcSwgcmVzKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihcIltjbGllbnRdXCIsIHJlcS5ib2R5KTtcclxuICAgICAgICByZXMuZW5kKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBhcHAubGlzdGVuKGFwcC5nZXQoXCJwb3J0XCIpLCBmdW5jdGlvbigpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIk5vZGUgYXBwIGlzIHJ1bm5pbmcgb24gcG9ydFwiLCBhcHAuZ2V0KFwicG9ydFwiKSk7XHJcbiAgICB9KTtcclxuXHJcbn1cclxuIiwiXHJcbi8vIHZhciBjYW52YXMgPSBuZXcgQ2FudmFzKDEwMDAsIDEwMDApO1xyXG4vLyBwYXBlci5zZXR1cChjYW52YXMpO1xyXG4vLyB2YXIgcmVnaW9uID0gcGFwZXIuUGF0aC5FbGxpcHNlKG5ldyBwYXBlci5SZWN0YW5nbGUoXHJcbi8vICAgICAgICAgICAgICAgICAgICAgbmV3IHBhcGVyLlBvaW50KDAsMCksXHJcbi8vICAgICAgICAgICAgICAgICAgICAgbmV3IHBhcGVyLlNpemUoNjAwLCAzMDApXHJcbi8vICAgICAgICAgICAgICAgICApKTtcclxuLy8gY29uc29sZS5sb2cocmVnaW9uLmJvdW5kcy5zaXplLndpZHRoKTtcclxuLy8gcmVnaW9uLnJvdGF0ZSgzMCk7XHJcbi8vIGNvbnNvbGUubG9nKHJlZ2lvbi5ib3VuZHMuc2l6ZS53aWR0aCk7XHJcblxyXG5zdGFydFNlcnZlcigpO1xyXG4iXX0=