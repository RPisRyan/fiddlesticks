var startServer = function () {
    var express = require("express");
    var bodyParser = require("body-parser");
    var aws = require("aws-sdk");
    var http = require("http");
    var path = require("path");
    var app = express();
    var AWS_ACCESS_KEY = process.env.AWS_ACCESS_KEY;
    var AWS_SECRET_KEY = process.env.AWS_SECRET_KEY;
    var S3_BUCKET = process.env.S3_BUCKET;
    app.use(bodyParser.json());
    app.set("port", (process.env.PORT || 7702));
    var sitePath = path.join(__dirname, "../../site");
    app.use("/css", express.static(path.join(sitePath, "css")));
    app.use("/fonts", express.static(path.join(sitePath, "fonts")));
    app.use("/lib", express.static(path.join(sitePath, "lib")));
    app.use("/img", express.static(path.join(sitePath, "img")));
    app.use("/content", express.static(path.join(sitePath, "content")));
    app.get("/", function (req, res) {
        res.sendFile(path.join(sitePath, "index.html"));
    });
    app.get("/sketch", function (req, res) {
        res.sendFile(path.join(sitePath, "sketch.html"));
    });
    app.get("/sketch/*", function (req, res) {
        res.sendFile(path.join(sitePath, "sketch.html"));
    });
    app.get("/demo", function (req, res) {
        res.sendFile(path.join(sitePath, "demo.html"));
    });
    app.get("/build", function (req, res) {
        res.sendFile(path.join(sitePath, "builder.html"));
    });
    app.get("/api/storage/access", function (req, res) {
        aws.config.update({ accessKeyId: AWS_ACCESS_KEY, secretAccessKey: AWS_SECRET_KEY });
        var s3 = new aws.S3();
        var s3params = {
            Bucket: S3_BUCKET,
            Key: req.query.fileName,
            Expires: 4000,
            ContentType: req.query.fileType,
            ACL: "public-read"
        };
        s3.getSignedUrl("putObject", s3params, function (err, data) {
            if (err) {
                console.log(err);
            }
            else {
                var returnData = {
                    signedRequest: data,
                    url: "https://" + S3_BUCKET + ".s3.amazonaws.com/" + req.query.fileName
                };
                res.type("application/json");
                res.write(JSON.stringify(returnData));
                res.end();
            }
        });
    });
    app.get("/api/storage/url", function (req, res) {
        var returnData = {
            url: "https://" + S3_BUCKET + ".s3.amazonaws.com/" + req.query.fileName
        };
        res.type("application/json");
        res.write(JSON.stringify(returnData));
        res.end();
    });
    app.post('/api/client-errors', function (req, res) {
        console.error("[client]", req.body);
        res.end();
    });
    app.listen(app.get("port"), function () {
        console.log("Node app is running on port", app.get("port"));
    });
};
startServer();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvc2VydmVyLmpzIiwiLi4vc3JjL3pfc3RhcnQuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsSUFBSSxXQUFXLEdBQUc7SUFFZCxJQUFJLE9BQU8sR0FBRyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDakMsSUFBSSxVQUFVLEdBQUcsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFBO0lBQ3ZDLElBQUksR0FBRyxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUM3QixJQUFJLElBQUksR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDM0IsSUFBSSxJQUFJLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBRTNCLElBQUksR0FBRyxHQUFHLE9BQU8sRUFBRSxDQUFDO0lBRXBCLElBQUksY0FBYyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDO0lBQ2hELElBQUksY0FBYyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDO0lBQ2hELElBQUksU0FBUyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDO0lBRXRDLEdBQUcsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7SUFFM0IsR0FBRyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBRTVDLElBQUksUUFBUSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLFlBQVksQ0FBQyxDQUFDO0lBRWxELEdBQUcsQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzVELEdBQUcsQ0FBQyxH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LCJzb3VyY2VzQ29udGVudCI6WyJcbnZhciBzdGFydFNlcnZlciA9IGZ1bmN0aW9uKCkge1xuXG4gICAgdmFyIGV4cHJlc3MgPSByZXF1aXJlKFwiZXhwcmVzc1wiKTtcbiAgICB2YXIgYm9keVBhcnNlciA9IHJlcXVpcmUoXCJib2R5LXBhcnNlclwiKVxuICAgIHZhciBhd3MgPSByZXF1aXJlKFwiYXdzLXNka1wiKTtcbiAgICB2YXIgaHR0cCA9IHJlcXVpcmUoXCJodHRwXCIpO1xuICAgIHZhciBwYXRoID0gcmVxdWlyZShcInBhdGhcIik7XG5cbiAgICB2YXIgYXBwID0gZXhwcmVzcygpO1xuXG4gICAgdmFyIEFXU19BQ0NFU1NfS0VZID0gcHJvY2Vzcy5lbnYuQVdTX0FDQ0VTU19LRVk7XG4gICAgdmFyIEFXU19TRUNSRVRfS0VZID0gcHJvY2Vzcy5lbnYuQVdTX1NFQ1JFVF9LRVk7XG4gICAgdmFyIFMzX0JVQ0tFVCA9IHByb2Nlc3MuZW52LlMzX0JVQ0tFVDtcblxuICAgIGFwcC51c2UoYm9keVBhcnNlci5qc29uKCkpO1xuXG4gICAgYXBwLnNldChcInBvcnRcIiwgKHByb2Nlc3MuZW52LlBPUlQgfHwgNzcwMikpO1xuXG4gICAgdmFyIHNpdGVQYXRoID0gcGF0aC5qb2luKF9fZGlybmFtZSwgXCIuLi8uLi9zaXRlXCIpO1xuXG4gICAgYXBwLnVzZShcIi9jc3NcIiwgZXhwcmVzcy5zdGF0aWMocGF0aC5qb2luKHNpdGVQYXRoLCBcImNzc1wiKSkpO1xuICAgIGFwcC51c2UoXCIvZm9udHNcIiwgZXhwcmVzcy5zdGF0aWMocGF0aC5qb2luKHNpdGVQYXRoLCBcImZvbnRzXCIpKSk7XG4gICAgYXBwLnVzZShcIi9saWJcIiwgZXhwcmVzcy5zdGF0aWMocGF0aC5qb2luKHNpdGVQYXRoLCBcImxpYlwiKSkpO1xuICAgIGFwcC51c2UoXCIvaW1nXCIsIGV4cHJlc3Muc3RhdGljKHBhdGguam9pbihzaXRlUGF0aCwgXCJpbWdcIikpKTtcbiAgICBhcHAudXNlKFwiL2NvbnRlbnRcIiwgZXhwcmVzcy5zdGF0aWMocGF0aC5qb2luKHNpdGVQYXRoLCBcImNvbnRlbnRcIikpKTtcblxuICAgIGFwcC5nZXQoXCIvXCIsIGZ1bmN0aW9uKHJlcSwgcmVzKSB7XG4gICAgICAgIHJlcy5zZW5kRmlsZShwYXRoLmpvaW4oc2l0ZVBhdGgsIFwiaW5kZXguaHRtbFwiKSk7XG4gICAgfSk7XG4gICAgYXBwLmdldChcIi9za2V0Y2hcIiwgZnVuY3Rpb24ocmVxLCByZXMpIHtcbiAgICAgICAgcmVzLnNlbmRGaWxlKHBhdGguam9pbihzaXRlUGF0aCwgXCJza2V0Y2guaHRtbFwiKSk7XG4gICAgfSk7XG4gICAgYXBwLmdldChcIi9za2V0Y2gvKlwiLCBmdW5jdGlvbihyZXEsIHJlcykge1xuICAgICAgICByZXMuc2VuZEZpbGUocGF0aC5qb2luKHNpdGVQYXRoLCBcInNrZXRjaC5odG1sXCIpKTtcbiAgICB9KTtcbiAgICBhcHAuZ2V0KFwiL2RlbW9cIiwgZnVuY3Rpb24ocmVxLCByZXMpIHtcbiAgICAgICAgcmVzLnNlbmRGaWxlKHBhdGguam9pbihzaXRlUGF0aCwgXCJkZW1vLmh0bWxcIikpO1xuICAgIH0pO1xuICAgIGFwcC5nZXQoXCIvYnVpbGRcIiwgZnVuY3Rpb24ocmVxLCByZXMpIHtcbiAgICAgICAgcmVzLnNlbmRGaWxlKHBhdGguam9pbihzaXRlUGF0aCwgXCJidWlsZGVyLmh0bWxcIikpO1xuICAgIH0pO1xuXG4gICAgYXBwLmdldChcIi9hcGkvc3RvcmFnZS9hY2Nlc3NcIiwgZnVuY3Rpb24ocmVxLCByZXMpIHtcbiAgICAgICAgYXdzLmNvbmZpZy51cGRhdGUoeyBhY2Nlc3NLZXlJZDogQVdTX0FDQ0VTU19LRVksIHNlY3JldEFjY2Vzc0tleTogQVdTX1NFQ1JFVF9LRVkgfSk7XG4gICAgICAgIHZhciBzMyA9IG5ldyBhd3MuUzMoKTtcbiAgICAgICAgdmFyIHMzcGFyYW1zID0ge1xuICAgICAgICAgICAgQnVja2V0OiBTM19CVUNLRVQsXG4gICAgICAgICAgICBLZXk6IHJlcS5xdWVyeS5maWxlTmFtZSxcbiAgICAgICAgICAgIEV4cGlyZXM6IDQwMDAsIC8vIG92ZXIgMSBob3VyXG4gICAgICAgICAgICBDb250ZW50VHlwZTogcmVxLnF1ZXJ5LmZpbGVUeXBlLFxuICAgICAgICAgICAgQUNMOiBcInB1YmxpYy1yZWFkXCJcbiAgICAgICAgfTtcbiAgICAgICAgczMuZ2V0U2lnbmVkVXJsKFwicHV0T2JqZWN0XCIsIHMzcGFyYW1zLCBmdW5jdGlvbihlcnIsIGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIHJldHVybkRhdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgIHNpZ25lZFJlcXVlc3Q6IGRhdGEsXG4gICAgICAgICAgICAgICAgICAgIHVybDogXCJodHRwczovL1wiICsgUzNfQlVDS0VUICsgXCIuczMuYW1hem9uYXdzLmNvbS9cIiArIHJlcS5xdWVyeS5maWxlTmFtZVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgcmVzLnR5cGUoXCJhcHBsaWNhdGlvbi9qc29uXCIpO1xuICAgICAgICAgICAgICAgIHJlcy53cml0ZShKU09OLnN0cmluZ2lmeShyZXR1cm5EYXRhKSk7XG4gICAgICAgICAgICAgICAgcmVzLmVuZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGFwcC5nZXQoXCIvYXBpL3N0b3JhZ2UvdXJsXCIsIGZ1bmN0aW9uKHJlcSwgcmVzKSB7XG4gICAgICAgIHZhciByZXR1cm5EYXRhID0ge1xuICAgICAgICAgICAgdXJsOiBcImh0dHBzOi8vXCIgKyBTM19CVUNLRVQgKyBcIi5zMy5hbWF6b25hd3MuY29tL1wiICsgcmVxLnF1ZXJ5LmZpbGVOYW1lXG4gICAgICAgIH07XG4gICAgICAgIHJlcy50eXBlKFwiYXBwbGljYXRpb24vanNvblwiKTtcbiAgICAgICAgcmVzLndyaXRlKEpTT04uc3RyaW5naWZ5KHJldHVybkRhdGEpKTtcbiAgICAgICAgcmVzLmVuZCgpO1xuICAgIH0pO1xuXG4gICAgYXBwLnBvc3QoJy9hcGkvY2xpZW50LWVycm9ycycsIGZ1bmN0aW9uKHJlcSwgcmVzKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJbY2xpZW50XVwiLCByZXEuYm9keSk7XG4gICAgICAgIHJlcy5lbmQoKTtcbiAgICB9KTtcblxuICAgIGFwcC5saXN0ZW4oYXBwLmdldChcInBvcnRcIiksIGZ1bmN0aW9uKCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIk5vZGUgYXBwIGlzIHJ1bm5pbmcgb24gcG9ydFwiLCBhcHAuZ2V0KFwicG9ydFwiKSk7XG4gICAgfSk7XG5cbn1cbiIsIlxuc3RhcnRTZXJ2ZXIoKTtcbiJdfQ==