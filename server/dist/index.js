function runTest() {
    var box = new paper.Path({
        segments: [
            new paper.Point(0, 0),
            new paper.Point(10, 0),
            new paper.Point(10, 10),
            new paper.Point(0, 10)
        ],
        closed: true
    });
    var section = new FontShape.PathSection(box, 0.1, 0.1);
    assertEqual(4, section.length);
    assertPointEqual(new paper.Point(4, 0), section.getPointAt(0));
    assertPointEqual(new paper.Point(8, 0), section.getPointAt(4));
    var sectionOverStart = new FontShape.PathSection(box, 0.9, 0.2);
    assertEqual(8, sectionOverStart.length);
    assertPointEqual(new paper.Point(0, 4), sectionOverStart.getPointAt(0));
    assertPointEqual(new paper.Point(4, 0), sectionOverStart.getPointAt(8));
}
function assertPointEqual(expected, actual) {
    if (expected.subtract(actual).length > 0.0001) {
        console.error("expected " + expected + ", was " + actual);
    }
}
function assertEqual(expected, actual) {
    if (Math.abs(expected - actual) > 0.0001) {
        console.error("expected " + expected + ", was " + actual);
    }
}
var paper = require("paper");
var Canvas = require('canvas'), Image = Canvas.Image;
var startServer = function () {
    var express = require("express");
    var bodyParser = require("body-parser");
    var aws = require("aws-sdk");
    var http = require("http");
    var path = require("path");
    var app = express();
    var AWS_ACCESS_KEY = process.env.AWS_ACCESS_KEY;
    var AWS_SECRET_KEY = process.env.AWS_SECRET_KEY;
    var S3_BUCKET = process.env.S3_BUCKET;
    app.use(bodyParser.json());
    app.set("port", (process.env.PORT || 7702));
    var sitePath = path.join(__dirname, "../../site");
    app.use("/css", express.static(path.join(sitePath, "css")));
    app.use("/fonts", express.static(path.join(sitePath, "fonts")));
    app.use("/lib", express.static(path.join(sitePath, "lib")));
    app.use("/img", express.static(path.join(sitePath, "img")));
    app.use("/content", express.static(path.join(sitePath, "content")));
    var indexPath = path.join(sitePath, "index.html");
    app.get("/", function (req, res) {
        res.sendFile(indexPath);
    });
    app.get("/sketch/*", function (req, res) {
        res.sendFile(indexPath);
    });
    app.get("/demo", function (req, res) {
        res.sendFile(path.join(sitePath, "demo.html"));
    });
    app.get("/build", function (req, res) {
        res.sendFile(path.join(sitePath, "builder.html"));
    });
    app.get("/api/storage/access", function (req, res) {
        aws.config.update({ accessKeyId: AWS_ACCESS_KEY, secretAccessKey: AWS_SECRET_KEY });
        var s3 = new aws.S3();
        var s3params = {
            Bucket: S3_BUCKET,
            Key: req.query.fileName,
            Expires: 4000,
            ContentType: req.query.fileType,
            ACL: "public-read"
        };
        s3.getSignedUrl("putObject", s3params, function (err, data) {
            if (err) {
                console.log(err);
            }
            else {
                var returnData = {
                    signedRequest: data,
                    url: "https://" + S3_BUCKET + ".s3.amazonaws.com/" + req.query.fileName
                };
                res.type("application/json");
                res.write(JSON.stringify(returnData));
                res.end();
            }
        });
    });
    app.get("/api/storage/url", function (req, res) {
        var returnData = {
            url: "https://" + S3_BUCKET + ".s3.amazonaws.com/" + req.query.fileName
        };
        res.type("application/json");
        res.write(JSON.stringify(returnData));
        res.end();
    });
    app.post('/api/client-errors', function (req, res) {
        console.error("[client]", req.body);
        res.end();
    });
    app.listen(app.get("port"), function () {
        console.log("Node app is running on port", app.get("port"));
    });
};
// var canvas = new Canvas(1000, 1000);
// paper.setup(canvas);
// var region = paper.Path.Ellipse(new paper.Rectangle(
//                     new paper.Point(0,0),
//                     new paper.Size(600, 300)
//                 ));
// console.log(region.bounds.size.width);
// region.rotate(30);
// console.log(region.bounds.size.width);
startServer();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvZm9udFNoYXBlVGVzdC50cyIsIi4uL3NyYy9kZXBzLmpzIiwiLi4vc3JjL3NlcnZlci5qcyIsIi4uL3NyYy96X3N0YXJ0LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBO0lBRUksSUFBTSxHQUFHLEdBQUcsSUFBSSxLQUFLLENBQUMsSUFBSSxDQUFDO1FBQ3ZCLFFBQVEsRUFBRTtZQUNOLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQ3JCLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBQ3RCLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDO1lBQ3ZCLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDO1NBQ3pCO1FBQ0QsTUFBTSxFQUFFLElBQUk7S0FDZixDQUFDLENBQUM7SUFFSCxJQUFNLE9BQU8sR0FBRyxJQUFJLFNBQVMsQ0FBQyxXQUFXLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUN6RCxXQUFXLENBQUMsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUMvQixnQkFBZ0IsQ0FBQyxJQUFJLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUMvRCxnQkFBZ0IsQ0FBQyxJQUFJLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUUvRCxJQUFNLGdCQUFnQixHQUFHLElBQUksU0FBUyxDQUFDLFdBQVcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ2xFLFdBQVcsQ0FBQyxDQUFDLEVBQUUsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDeEMsZ0JBQWdCLENBQUMsSUFBSSxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxnQkFBZ0IsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN4RSxnQkFBZ0IsQ0FBQyxJQUFJLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLGdCQUFnQixDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBRTVFLENBQUM7QUFFRCwwQkFBMEIsUUFBcUIsRUFBRSxNQUFtQjtJQUNoRSxFQUFFLENBQUMsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBQzVDLE9BQU8sQ0FBQyxLQUFLLENBQUMsY0FBWSxRQUFRLGNBQVMsTUFBUSxDQUFDLENBQUM7SUFDekQsQ0FBQztBQUNMLENBQUM7QUFFRCxxQkFBcUIsUUFBZ0IsRUFBRSxNQUFjO0lBQ2pELEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsUUFBUSxHQUFHLE1BQU0sQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDdkMsT0FBTyxDQUFDLEtBQUssQ0FBQyxjQUFZLFFBQVEsY0FBUyxNQUFRLENBQUMsQ0FBQztJQUN6RCxDQUFDO0FBQ0wsQ0FBQztBQ25DRCxJQUFJLEtBQUssR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7QUFFN0IsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUMxQixLQUFLLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQztBQ0Z6QixJQUFJLFdBQVcsR0FBRztJQUVkLElBQUksT0FBTyxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUNqQyxJQUFJLFVBQVUsR0FBRyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUE7SUFDdkMsSUFBSSxHQUFHLEdBQUcsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQzdCLElBQUksSUFBSSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUMzQixJQUFJLElBQUksR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7SUFFM0IsSUFBSSxHQUFHLEdBQUcsT0FBTyxFQUFFLENBQUM7SUFFcEIsSUFBSSxjQUFjLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUM7SUFDaEQsSUFBSSxjQUFjLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUM7SUFDaEQsSUFBSSxTQUFTLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUM7SUFFdEMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztJQUUzQixHQUFHLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUM7SUFFNUMsSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsWUFBWSxDQUFDLENBQUM7SUFFbEQsR0FBRyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDNUQsR0FBRyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDaEUsR0FBRyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDNUQsR0FBRyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDNUQsR0FBRyxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUUsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFFcEUsSUFBSSxTQUFTLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsWUFBWSxDQUFDLENBQUM7SUFDbEQsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsVUFBUyxHQUFHLEVBQUUsR0FBRztRQUMxQixHQUFHLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQzVCLENBQUMsQ0FBQyxDQUFDO0lBQ0gsR0FBRyxDQUFDLEdBQUcsQ0FBQyxXQUFXLEVBQUUsVUFBUyxHQUFHLEVBQUUsR0FBRztRQUNsQyxHQUFHLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQzVCLENBQUMsQ0FBQyxDQUFDO0lBQ0gsR0FBRyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsVUFBUyxHQUFHLEVBQUUsR0FBRztRQUM5QixHQUFHLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLFdBQVcsQ0FBQyxDQUFDLENBQUM7SUFDbkQsQ0FBQyxDQUFDLENBQUM7SUFDSCxHQUFHLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxVQUFTLEdBQUcsRUFBRSxHQUFHO1FBQy9CLEdBQUcsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsY0FBYyxDQUFDLENBQUMsQ0FBQztJQUN0RCxDQUFDLENBQUMsQ0FBQztJQUVILEdBQUcsQ0FBQyxHQUFHLENBQUMscUJBQXFCLEVBQUUsVUFBUyxHQUFHLEVBQUUsR0FBRztRQUM1QyxHQUFHLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLFdBQVcsRUFBRSxjQUFjLEVBQUUsZUFBZSxFQUFFLGNBQWMsRUFBRSxDQUFDLENBQUM7UUFDcEYsSUFBSSxFQUFFLEdBQUcsSUFBSSxHQUFHLENBQUMsRUFBRSxFQUFFLENBQUM7UUFDdEIsSUFBSSxRQUFRLEdBQUc7WUFDWCxNQUFNLEVBQUUsU0FBUztZQUNqQixHQUFHLEVBQUUsR0FBRyxDQUFDLEtBQUssQ0FBQyxRQUFRO1lBQ3ZCLE9BQU8sRUFBRSxJQUFJO1lBQ2IsV0FBVyxFQUFFLEdBQUcsQ0FBQyxLQUFLLENBQUMsUUFBUTtZQUMvQixHQUFHLEVBQUUsYUFBYTtTQUNyQixDQUFDO1FBQ0YsRUFBRSxDQUFDLFlBQVksQ0FBQyxXQUFXLEVBQUUsUUFBUSxFQUFFLFVBQVMsR0FBRyxFQUFFLElBQUk7WUFDckQsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFDTixPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3JCLENBQUM7WUFDRCxJQUFJLENBQUMsQ0FBQztnQkFDRixJQUFJLFVBQVUsR0FBRztvQkFDYixhQUFhLEVBQUUsSUFBSTtvQkFDbkIsR0FBRyxFQUFFLFVBQVUsR0FBRyxTQUFTLEdBQUcsb0JBQW9CLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxRQUFRO2lCQUMxRSxDQUFDO2dCQUNGLEdBQUcsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQztnQkFDN0IsR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7Z0JBQ3RDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUNkLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0lBRUgsR0FBRyxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsRUFBRSxVQUFTLEdBQUcsRUFBRSxHQUFHO1FBQ3pDLElBQUksVUFBVSxHQUFHO1lBQ2IsR0FBRyxFQUFFLFVBQVUsR0FBRyxTQUFTLEdBQUcsb0JBQW9CLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxRQUFRO1NBQzFFLENBQUM7UUFDRixHQUFHLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUM7UUFDN0IsR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7UUFDdEMsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDO0lBQ2QsQ0FBQyxDQUFDLENBQUM7SUFFSCxHQUFHLENBQUMsSUFBSSxDQUFDLG9CQUFvQixFQUFFLFVBQVMsR0FBRyxFQUFFLEdBQUc7UUFDNUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxVQUFVLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3BDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztJQUNkLENBQUMsQ0FBQyxDQUFDO0lBRUgsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFO1FBQ3hCLE9BQU8sQ0FBQyxHQUFHLENBQUMsNkJBQTZCLEVBQUUsR0FBRyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO0lBQ2hFLENBQUMsQ0FBQyxDQUFDO0FBRVAsQ0FBQyxDQUFBO0FDcEZELHVDQUF1QztBQUN2Qyx1QkFBdUI7QUFDdkIsdURBQXVEO0FBQ3ZELDRDQUE0QztBQUM1QywrQ0FBK0M7QUFDL0Msc0JBQXNCO0FBQ3RCLHlDQUF5QztBQUN6QyxxQkFBcUI7QUFDckIseUNBQXlDO0FBRXpDLFdBQVcsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiXHJcbmZ1bmN0aW9uIHJ1blRlc3QoKSB7XHJcblxyXG4gICAgY29uc3QgYm94ID0gbmV3IHBhcGVyLlBhdGgoe1xyXG4gICAgICAgIHNlZ21lbnRzOiBbXHJcbiAgICAgICAgICAgIG5ldyBwYXBlci5Qb2ludCgwLCAwKSxcclxuICAgICAgICAgICAgbmV3IHBhcGVyLlBvaW50KDEwLCAwKSxcclxuICAgICAgICAgICAgbmV3IHBhcGVyLlBvaW50KDEwLCAxMCksXHJcbiAgICAgICAgICAgIG5ldyBwYXBlci5Qb2ludCgwLCAxMClcclxuICAgICAgICBdLFxyXG4gICAgICAgIGNsb3NlZDogdHJ1ZVxyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc3Qgc2VjdGlvbiA9IG5ldyBGb250U2hhcGUuUGF0aFNlY3Rpb24oYm94LCAwLjEsIDAuMSk7XHJcbiAgICBhc3NlcnRFcXVhbCg0LCBzZWN0aW9uLmxlbmd0aCk7XHJcbiAgICBhc3NlcnRQb2ludEVxdWFsKG5ldyBwYXBlci5Qb2ludCg0LCAwKSwgc2VjdGlvbi5nZXRQb2ludEF0KDApKTtcclxuICAgIGFzc2VydFBvaW50RXF1YWwobmV3IHBhcGVyLlBvaW50KDgsIDApLCBzZWN0aW9uLmdldFBvaW50QXQoNCkpO1xyXG5cclxuICAgIGNvbnN0IHNlY3Rpb25PdmVyU3RhcnQgPSBuZXcgRm9udFNoYXBlLlBhdGhTZWN0aW9uKGJveCwgMC45LCAwLjIpO1xyXG4gICAgYXNzZXJ0RXF1YWwoOCwgc2VjdGlvbk92ZXJTdGFydC5sZW5ndGgpO1xyXG4gICAgYXNzZXJ0UG9pbnRFcXVhbChuZXcgcGFwZXIuUG9pbnQoMCwgNCksIHNlY3Rpb25PdmVyU3RhcnQuZ2V0UG9pbnRBdCgwKSk7XHJcbiAgICBhc3NlcnRQb2ludEVxdWFsKG5ldyBwYXBlci5Qb2ludCg0LCAwKSwgc2VjdGlvbk92ZXJTdGFydC5nZXRQb2ludEF0KDgpKTtcclxuXHJcbn1cclxuXHJcbmZ1bmN0aW9uIGFzc2VydFBvaW50RXF1YWwoZXhwZWN0ZWQ6IHBhcGVyLlBvaW50LCBhY3R1YWw6IHBhcGVyLlBvaW50KXtcclxuICAgIGlmIChleHBlY3RlZC5zdWJ0cmFjdChhY3R1YWwpLmxlbmd0aCA+IDAuMDAwMSkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYGV4cGVjdGVkICR7ZXhwZWN0ZWR9LCB3YXMgJHthY3R1YWx9YCk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGFzc2VydEVxdWFsKGV4cGVjdGVkOiBudW1iZXIsIGFjdHVhbDogbnVtYmVyKXtcclxuICAgIGlmIChNYXRoLmFicyhleHBlY3RlZCAtIGFjdHVhbCkgPiAwLjAwMDEpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGBleHBlY3RlZCAke2V4cGVjdGVkfSwgd2FzICR7YWN0dWFsfWApO1xyXG4gICAgfVxyXG59XHJcbiIsInZhciBwYXBlciA9IHJlcXVpcmUoXCJwYXBlclwiKTtcclxuXHJcbnZhciBDYW52YXMgPSByZXF1aXJlKCdjYW52YXMnKVxyXG4gICwgSW1hZ2UgPSBDYW52YXMuSW1hZ2U7IiwiXHJcbnZhciBzdGFydFNlcnZlciA9IGZ1bmN0aW9uKCkge1xyXG5cclxuICAgIHZhciBleHByZXNzID0gcmVxdWlyZShcImV4cHJlc3NcIik7XHJcbiAgICB2YXIgYm9keVBhcnNlciA9IHJlcXVpcmUoXCJib2R5LXBhcnNlclwiKVxyXG4gICAgdmFyIGF3cyA9IHJlcXVpcmUoXCJhd3Mtc2RrXCIpO1xyXG4gICAgdmFyIGh0dHAgPSByZXF1aXJlKFwiaHR0cFwiKTtcclxuICAgIHZhciBwYXRoID0gcmVxdWlyZShcInBhdGhcIik7XHJcblxyXG4gICAgdmFyIGFwcCA9IGV4cHJlc3MoKTtcclxuXHJcbiAgICB2YXIgQVdTX0FDQ0VTU19LRVkgPSBwcm9jZXNzLmVudi5BV1NfQUNDRVNTX0tFWTtcclxuICAgIHZhciBBV1NfU0VDUkVUX0tFWSA9IHByb2Nlc3MuZW52LkFXU19TRUNSRVRfS0VZO1xyXG4gICAgdmFyIFMzX0JVQ0tFVCA9IHByb2Nlc3MuZW52LlMzX0JVQ0tFVDtcclxuXHJcbiAgICBhcHAudXNlKGJvZHlQYXJzZXIuanNvbigpKTtcclxuXHJcbiAgICBhcHAuc2V0KFwicG9ydFwiLCAocHJvY2Vzcy5lbnYuUE9SVCB8fCA3NzAyKSk7XHJcblxyXG4gICAgdmFyIHNpdGVQYXRoID0gcGF0aC5qb2luKF9fZGlybmFtZSwgXCIuLi8uLi9zaXRlXCIpO1xyXG5cclxuICAgIGFwcC51c2UoXCIvY3NzXCIsIGV4cHJlc3Muc3RhdGljKHBhdGguam9pbihzaXRlUGF0aCwgXCJjc3NcIikpKTtcclxuICAgIGFwcC51c2UoXCIvZm9udHNcIiwgZXhwcmVzcy5zdGF0aWMocGF0aC5qb2luKHNpdGVQYXRoLCBcImZvbnRzXCIpKSk7XHJcbiAgICBhcHAudXNlKFwiL2xpYlwiLCBleHByZXNzLnN0YXRpYyhwYXRoLmpvaW4oc2l0ZVBhdGgsIFwibGliXCIpKSk7XHJcbiAgICBhcHAudXNlKFwiL2ltZ1wiLCBleHByZXNzLnN0YXRpYyhwYXRoLmpvaW4oc2l0ZVBhdGgsIFwiaW1nXCIpKSk7XHJcbiAgICBhcHAudXNlKFwiL2NvbnRlbnRcIiwgZXhwcmVzcy5zdGF0aWMocGF0aC5qb2luKHNpdGVQYXRoLCBcImNvbnRlbnRcIikpKTtcclxuXHJcbiAgICB2YXIgaW5kZXhQYXRoID0gcGF0aC5qb2luKHNpdGVQYXRoLCBcImluZGV4Lmh0bWxcIik7XHJcbiAgICBhcHAuZ2V0KFwiL1wiLCBmdW5jdGlvbihyZXEsIHJlcykge1xyXG4gICAgICAgIHJlcy5zZW5kRmlsZShpbmRleFBhdGgpO1xyXG4gICAgfSk7XHJcbiAgICBhcHAuZ2V0KFwiL3NrZXRjaC8qXCIsIGZ1bmN0aW9uKHJlcSwgcmVzKSB7XHJcbiAgICAgICAgcmVzLnNlbmRGaWxlKGluZGV4UGF0aCk7XHJcbiAgICB9KTtcclxuICAgIGFwcC5nZXQoXCIvZGVtb1wiLCBmdW5jdGlvbihyZXEsIHJlcykge1xyXG4gICAgICAgIHJlcy5zZW5kRmlsZShwYXRoLmpvaW4oc2l0ZVBhdGgsIFwiZGVtby5odG1sXCIpKTtcclxuICAgIH0pO1xyXG4gICAgYXBwLmdldChcIi9idWlsZFwiLCBmdW5jdGlvbihyZXEsIHJlcykge1xyXG4gICAgICAgIHJlcy5zZW5kRmlsZShwYXRoLmpvaW4oc2l0ZVBhdGgsIFwiYnVpbGRlci5odG1sXCIpKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGFwcC5nZXQoXCIvYXBpL3N0b3JhZ2UvYWNjZXNzXCIsIGZ1bmN0aW9uKHJlcSwgcmVzKSB7XHJcbiAgICAgICAgYXdzLmNvbmZpZy51cGRhdGUoeyBhY2Nlc3NLZXlJZDogQVdTX0FDQ0VTU19LRVksIHNlY3JldEFjY2Vzc0tleTogQVdTX1NFQ1JFVF9LRVkgfSk7XHJcbiAgICAgICAgdmFyIHMzID0gbmV3IGF3cy5TMygpO1xyXG4gICAgICAgIHZhciBzM3BhcmFtcyA9IHtcclxuICAgICAgICAgICAgQnVja2V0OiBTM19CVUNLRVQsXHJcbiAgICAgICAgICAgIEtleTogcmVxLnF1ZXJ5LmZpbGVOYW1lLFxyXG4gICAgICAgICAgICBFeHBpcmVzOiA0MDAwLCAvLyBvdmVyIDEgaG91clxyXG4gICAgICAgICAgICBDb250ZW50VHlwZTogcmVxLnF1ZXJ5LmZpbGVUeXBlLFxyXG4gICAgICAgICAgICBBQ0w6IFwicHVibGljLXJlYWRcIlxyXG4gICAgICAgIH07XHJcbiAgICAgICAgczMuZ2V0U2lnbmVkVXJsKFwicHV0T2JqZWN0XCIsIHMzcGFyYW1zLCBmdW5jdGlvbihlcnIsIGRhdGEpIHtcclxuICAgICAgICAgICAgaWYgKGVycikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXR1cm5EYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHNpZ25lZFJlcXVlc3Q6IGRhdGEsXHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBcImh0dHBzOi8vXCIgKyBTM19CVUNLRVQgKyBcIi5zMy5hbWF6b25hd3MuY29tL1wiICsgcmVxLnF1ZXJ5LmZpbGVOYW1lXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgcmVzLnR5cGUoXCJhcHBsaWNhdGlvbi9qc29uXCIpO1xyXG4gICAgICAgICAgICAgICAgcmVzLndyaXRlKEpTT04uc3RyaW5naWZ5KHJldHVybkRhdGEpKTtcclxuICAgICAgICAgICAgICAgIHJlcy5lbmQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgYXBwLmdldChcIi9hcGkvc3RvcmFnZS91cmxcIiwgZnVuY3Rpb24ocmVxLCByZXMpIHtcclxuICAgICAgICB2YXIgcmV0dXJuRGF0YSA9IHtcclxuICAgICAgICAgICAgdXJsOiBcImh0dHBzOi8vXCIgKyBTM19CVUNLRVQgKyBcIi5zMy5hbWF6b25hd3MuY29tL1wiICsgcmVxLnF1ZXJ5LmZpbGVOYW1lXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXMudHlwZShcImFwcGxpY2F0aW9uL2pzb25cIik7XHJcbiAgICAgICAgcmVzLndyaXRlKEpTT04uc3RyaW5naWZ5KHJldHVybkRhdGEpKTtcclxuICAgICAgICByZXMuZW5kKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBhcHAucG9zdCgnL2FwaS9jbGllbnQtZXJyb3JzJywgZnVuY3Rpb24ocmVxLCByZXMpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwiW2NsaWVudF1cIiwgcmVxLmJvZHkpO1xyXG4gICAgICAgIHJlcy5lbmQoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGFwcC5saXN0ZW4oYXBwLmdldChcInBvcnRcIiksIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiTm9kZSBhcHAgaXMgcnVubmluZyBvbiBwb3J0XCIsIGFwcC5nZXQoXCJwb3J0XCIpKTtcclxuICAgIH0pO1xyXG5cclxufVxyXG4iLCJcclxuLy8gdmFyIGNhbnZhcyA9IG5ldyBDYW52YXMoMTAwMCwgMTAwMCk7XHJcbi8vIHBhcGVyLnNldHVwKGNhbnZhcyk7XHJcbi8vIHZhciByZWdpb24gPSBwYXBlci5QYXRoLkVsbGlwc2UobmV3IHBhcGVyLlJlY3RhbmdsZShcclxuLy8gICAgICAgICAgICAgICAgICAgICBuZXcgcGFwZXIuUG9pbnQoMCwwKSxcclxuLy8gICAgICAgICAgICAgICAgICAgICBuZXcgcGFwZXIuU2l6ZSg2MDAsIDMwMClcclxuLy8gICAgICAgICAgICAgICAgICkpO1xyXG4vLyBjb25zb2xlLmxvZyhyZWdpb24uYm91bmRzLnNpemUud2lkdGgpO1xyXG4vLyByZWdpb24ucm90YXRlKDMwKTtcclxuLy8gY29uc29sZS5sb2cocmVnaW9uLmJvdW5kcy5zaXplLndpZHRoKTtcclxuXHJcbnN0YXJ0U2VydmVyKCk7XHJcbiJdfQ==